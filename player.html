<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Local Audio Player</title>
    <style>
        :root {
            --bg-color: #f4f4f4;
            --text-color: #333;
            --border-color: #ccc;
            --btn-bg: #e0e0e0;
            --btn-hover: #d0d0d0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            box-sizing: border-box;
        }

        .player-container {
            width: 100%;
            max-width: 600px;
            background: #fff;
            border: 1px solid var(--border-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Input and Select Styles */
        .file-controls {
            display: flex;
            gap: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }

        input[type="file"] {
            display: none;
        }

        .custom-file-upload {
            border: 1px solid var(--border-color);
            display: inline-block;
            padding: 8px 12px;
            cursor: pointer;
            background-color: var(--btn-bg);
            font-size: 14px;
            white-space: nowrap;
        }

        .custom-file-upload:hover {
            background-color: var(--btn-hover);
        }

        select {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid var(--border-color);
            background: #fff;
            font-size: 14px;
            /* Ellipsis for long filenames */
            text-overflow: ellipsis; 
            white-space: nowrap;
            overflow: hidden;
        }

        /* Info Display */
        .track-info {
            text-align: center;
            font-size: 14px;
            margin: 10px 0;
            min-height: 20px;
        }

        /* Progress Bar */
        .progress-container {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: monospace;
            font-size: 12px;
        }

        input[type="range"] {
            flex-grow: 1;
            cursor: pointer;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        button {
            border: 1px solid var(--border-color);
            background-color: var(--btn-bg);
            padding: 10px 20px;
            cursor: pointer;
            font-size: 14px;
            min-width: 60px;
        }

        button:hover {
            background-color: var(--btn-hover);
        }

        button:active {
            background-color: #bfbfbf;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>

<div class="player-container">
    <div class="file-controls">
        <label class="custom-file-upload">
            <input type="file" id="folderInput" webkitdirectory directory multiple>
            Select Folder
        </label>
        <select id="fileDropdown" disabled>
            <option>No files selected</option>
        </select>
    </div>

    <div class="track-info" id="trackName">Waiting for folder...</div>

    <div class="progress-container">
        <span id="currentTime">0:00</span>
        <input type="range" id="progressBar" value="0" min="0" step="0.1" disabled>
        <span id="duration">0:00</span>
    </div>

    <div class="controls">
        <button id="prevBtn" disabled>&#171; Prev</button>
        <button id="restartBtn" disabled>Restart</button>
        <button id="playPauseBtn" disabled>Play</button>
        <button id="nextBtn" disabled>Next &#187;</button>
    </div>
</div>

<script>
    // DOM Elements
    const folderInput = document.getElementById('folderInput');
    const fileDropdown = document.getElementById('fileDropdown');
    const trackNameDisplay = document.getElementById('trackName');
    const progressBar = document.getElementById('progressBar');
    const currentTimeEl = document.getElementById('currentTime');
    const durationEl = document.getElementById('duration');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const restartBtn = document.getElementById('restartBtn');

    // State
    let audio = new Audio();
    let playlist = []; // Array of File objects
    let currentIndex = -1;
    let isDraggingProgress = false;

    // Supported extensions
    const supportedTypes = ['audio/mpeg', 'audio/mp3', 'audio/ogg', 'audio/wav'];

    // 1. Handle Folder Selection
    folderInput.addEventListener('change', (e) => {
        const files = Array.from(e.target.files);
        
        // Filter and Sort (A-Z)
        playlist = files.filter(file => 
            supportedTypes.includes(file.type) || file.name.toLowerCase().endsWith('.mp3')
        ).sort((a, b) => a.name.localeCompare(b.name));

        if (playlist.length === 0) {
            alert("No audio files found in this folder.");
            resetPlayer();
            return;
        }

        // Populate Dropdown
        fileDropdown.innerHTML = '';
        playlist.forEach((file, index) => {
            const option = document.createElement('option');
            option.value = index;
            option.textContent = file.name;
            fileDropdown.appendChild(option);
        });

        // Enable UI
        fileDropdown.disabled = false;
        progressBar.disabled = false;
        prevBtn.disabled = false;
        nextBtn.disabled = false;
        restartBtn.disabled = false;
        playPauseBtn.disabled = false;

        // Select first track (don't auto play immediately on folder load, wait for user)
        loadTrack(0, false);
    });

    // 2. Handle Dropdown Selection
    fileDropdown.addEventListener('change', (e) => {
        loadTrack(parseInt(e.target.value), true);
    });

    // 3. Audio Loading Logic
    function loadTrack(index, autoPlay) {
        if (index < 0 || index >= playlist.length) return;

        currentIndex = index;
        fileDropdown.value = currentIndex;
        const file = playlist[currentIndex];
        
        trackNameDisplay.textContent = file.name;

        // Clean up old object URL to avoid memory leaks
        if (audio.src) {
            URL.revokeObjectURL(audio.src);
        }

        const fileURL = URL.createObjectURL(file);
        audio.src = fileURL;
        audio.load();

        if (autoPlay) {
            playAudio();
        } else {
            // Update UI to paused state
            playPauseBtn.textContent = "Play";
            currentTimeEl.textContent = "0:00";
            progressBar.value = 0;
        }
    }

    // 4. Playback Controls
    function playAudio() {
        audio.play().then(() => {
            playPauseBtn.textContent = "Pause";
        }).catch(err => console.error("Playback failed:", err));
    }

    function pauseAudio() {
        audio.pause();
        playPauseBtn.textContent = "Play";
    }

    playPauseBtn.addEventListener('click', () => {
        if (audio.paused) playAudio();
        else pauseAudio();
    });

    restartBtn.addEventListener('click', () => {
        audio.currentTime = 0;
        playAudio();
    });

    prevBtn.addEventListener('click', () => {
        let newIndex = currentIndex - 1;
        if (newIndex < 0) newIndex = playlist.length - 1; // Loop to end
        loadTrack(newIndex, true);
    });

    nextBtn.addEventListener('click', () => {
        let newIndex = currentIndex + 1;
        if (newIndex >= playlist.length) newIndex = 0; // Loop to start
        loadTrack(newIndex, true);
    });

    // 5. Progress Bar & Time Update
    audio.addEventListener('loadedmetadata', () => {
        durationEl.textContent = formatTime(audio.duration);
        progressBar.max = audio.duration;
    });

    audio.addEventListener('timeupdate', () => {
        if (!isDraggingProgress) {
            progressBar.value = audio.currentTime;
            currentTimeEl.textContent = formatTime(audio.currentTime);
        }
    });

    // Seeking
    progressBar.addEventListener('input', () => {
        isDraggingProgress = true;
        currentTimeEl.textContent = formatTime(progressBar.value);
    });

    progressBar.addEventListener('change', () => {
        isDraggingProgress = false;
        audio.currentTime = progressBar.value;
    });

    // Auto-play next track when ended
    audio.addEventListener('ended', () => {
        nextBtn.click();
    });

    // Utility: Format seconds to MM:SS
    function formatTime(seconds) {
        if (isNaN(seconds)) return "0:00";
        const m = Math.floor(seconds / 60);
        const s = Math.floor(seconds % 60);
        return `${m}:${s < 10 ? '0' : ''}${s}`;
    }

    function resetPlayer() {
        fileDropdown.innerHTML = '<option>No files selected</option>';
        fileDropdown.disabled = true;
        trackNameDisplay.textContent = "Waiting for folder...";
        currentTimeEl.textContent = "0:00";
        durationEl.textContent = "0:00";
        progressBar.value = 0;
        progressBar.disabled = true;
        document.querySelectorAll('.controls button').forEach(b => b.disabled = true);
        if (audio.src) URL.revokeObjectURL(audio.src);
        audio = new Audio();
        playlist = [];
    }
</script>

</body>
</html>